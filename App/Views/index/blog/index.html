<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>{$title}</title>
    <link rel="stylesheet" href="/public/web/layui/css/layui.css">
    <link rel="stylesheet" href="/public/site/css/common.css">
</head>
<body style="background: #F5F5F5">
<div class="blog_header">
    <img src="/public/site/img/blog_bg.png" style="max-height: 237px;width: 100%">
</div>
<div class="blog_contents" id="blog_contents" style="overflow: hidden">
    {volist name="blog" id="v"}
    <div class="bold_card">
        <div class="title" >
            <img src="{$v.avatar}" >

            <div class="info">
                <p>{$v.nickname}</p>
                <span>{:substr_replace($v['username'], '****', 2, 4)}</span>
            </div>
        </div>
        <div class="contents">
            <div class="text">{$v.contents}</div>
            <div class="image">
                {notempty name='v.image'}
                    {php}
                    if(count($v['image'])>=3){
                        $col =4;
                    }else if(count($v['image'])>=2){
                        $col =6;
                    }else{
                        $col =4;
                    }
                    {/php}
                    <div class="layui-row layui-col-space10">
                        {volist name='v.image' id="img"}
                        <div class="layui-col-md{$col} layui-col-xs{$col}">
                            <img  class="blog_img" src="{$img}" >
                        </div>
                        {/volist}
                    </div>
                {/notempty}
            </div>
        </div>
        <div style="border-bottom:  1px solid #EEEEEE;margin-bottom: 10px"></div>
        <div class="footer">
            <div class="icon">
                <img src="/public/site/img/blog_gold.png" alt=""> <p><em class="currency">{$system['currency']}</em>{$v.reward_amount}</p>
            </div>
            <div class="date"><p>{$v.create_time}</p></div>
        </div>
    </div>
    {/volist}
</div>

<!--	底部内容-开始	  -->
{include file="index/common/blog_post"}
<!--	底部内容-结束	  -->

<!--	底部内容-开始	  -->
{include file="index/common/footer_menu"}
<!--	底部内容-结束	  -->

<!-- body 末尾处引入 layui -->
<script src="/public/web/layui/layui.js"></script>

<script>
    layui.use(function(){
        var  $= layui.jquery;
        var  layer= layui.layer;
        var flow = layui.flow;

        $(document).on('click','.blog_img',function () {
            var image = $(this).attr('src')
            layer.photos({
                photos: {
                    "title": "blog image",
                    "start": 0,
                    "data": [
                        {
                            "alt": "",
                            "pid": 1,
                            "src": image,
                        }
                    ]
                },
                footer: false // 是否显示底部栏 --- 2.8.16+
            });
        })
        $('.rules').click(function(){
            var l = "{$lang}"
            if(l=='Cn'){
                var content ='<div style="padding: 20px;">' +
                    '<h3 class="layui-padding-1">分享取款截图以获得现金奖励</h3>' +
                    '<p class="layui-padding-1 layui-font-16">方法1：将最新成功提款的截图发送到评论区，通过审核后，您将立即获得{$system.customer_config.blog_post_min_amount}-{$system.customer_config.blog_post_max_amount}的奖励。</p>' +
                    '<p class="layui-padding-1 layui-font-16">方法2.在评论区写下你的体验，告诉其他用户你赚了多少钱。通过评论后，你会得到{$system.customer_config.blog_post_min_amount}-{$system.customer_config.blog_post_max_amount}的奖励。</p>' +
                    '</div>'
            }else{
                var content ='<div style="padding: 12px;border-radius: 10px">' +
                    '<h2 style="border-bottom: 1px solid #F0F0F0;padding-bottom: 10px" ">Reward Description</h2>' +
                    '<h3 style="padding: 10px 0" ">Share withdrawal screenshots to receive cash rewards</h3>' +
                    '<p class="rules_contents">1.Send a screenshot of the latest successful withdrawal to the comment section, and once approved, you will immediately receive a reward of {$system.customer_config.blog_post_min_amount}-{$system.customer_config.blog_post_max_amount}.</p>' +
                    '</div>'
            }

            layer.open({
                type: 1,
                area: ['80%', 'auto'], // 宽高
                title: false, // 不显示标题栏
                closeBtn: true,
                shadeClose: true, // 点击遮罩关闭层
                content: content
            });
        })


        // 流加载实例
        flow.load({
            elem: '#blog_contents', // 流加载容器
            scrollElem: '#blog_contents', // 滚动条所在元素，一般不用填，此处只是演示需要。
            done: function(page, next){ // 执行下一页的回调
                console.log(page)
                var lis = [];
                $.get('/getBlog?page='+page,function (res) {
                    layui.each(res.result.list,function (index,item) {
                        var html = '    <div class="bold_card">\n' +
                            '        <div class="title" >\n' +
                            '            <img src="'+item.avatar+'" >\n' +
                            '\n' +
                            '            <div class="info">\n' +
                            '                <p>'+item.nickname+'</p>\n' +
                            '                <span>'+item.username+'</span>\n' +
                            '            </div>\n' +
                            '        </div>\n' +
                            '        <div class="contents">\n' +
                            '            <div class="text">'+item.contents+'</div>\n'

                        if(item.image){
                            html += '<div class="image">' +
                                '<div class="layui-row layui-col-space1">\n' ;
                            layui.each(item.image,function (key,image) {
                                html += '       <div class="layui-col-md'+item.col+' layui-col-xs'+item.col+' ">\n' +
                                    '                 <img  class="blog_img" src="'+image+' " >\n' +
                                    '            </div>\n'

                            })
                            html+= '</div>\n</div>';
                        }
                        html += ' </div>\n' +
                            '        <div style="border-bottom:  1px solid #EEEEEE;margin-bottom: 10px"></div>\n' +
                            '        <div class="footer">\n' +
                            '            <div class="icon">\n' +
                            '                <img src="/public/site/img/blog_gold.png" alt=""> <p><em class="currency">{$system["currency"]}</em>'+item.reward_amount+'</p>\n' +
                            '            </div>\n' +
                            '            <div class="date"><p>'+item.create_time+'</p></div>\n' +
                            '        </div>\n' +
                            '    </div>' ;
                        lis.push(html);
                    })

                    next(lis.join(''), page < res.result.page); // 此处假设总页数为 10

                })


                // 执行下一页渲染，第二参数为：满足“加载更多”的条件，即后面仍有分页
                // pages 为 Ajax返回的总页数，只有当前页小于总页数的情况下，才会继续出现加载更多
            }
        });

    });
</script>
</body>
</html>
